<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trang Qu·∫£n Tr·ªã - SkyDrone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../../stylesheets/admin/profile-admin.css">


</head>
<body>

<!-- ===== HEADER ===== -->
<header class="main-header">
    <div class="logo">
        <img src="/image/logoo2.png" alt="Logo">
        <h2>SkyDrone Admin</h2>
    </div>
    <div class="header-right">
        <!-- Icon admin + t√™n -->
        <a href="profile-admin.html" class="text-decoration-none text-while">
            <div class="thong-tin-admin d-flex align-items-center gap-2">
                <i class="bi bi-person-circle fs-4"></i>
                <span class="fw-semibold">Admin</span>
            </div>
        </a>

        <button class="logout-btn" id="logoutBtn" title="ƒêƒÉng xu·∫•t">
            <i class="bi bi-box-arrow-right"></i>
        </button>
    </div>
    <div class="logout-modal" id="logoutModal">
        <div class="logout-modal-content">
            <p>B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?</p>
            <div class="logout-actions">
                <a href="../login.html">
                    <button id="confirmLogout" class="confirm">C√≥</button>
                </a>
                <button id="cancelLogout" class="cancel">Kh√¥ng</button>
            </div>
        </div>
    </div>
</header>

<!-- ===== LAYOUT ===== -->
<div class="layout">
    <!-- === SIDEBAR === -->
    <aside class="sidebar">
        <div class="user-info">
            <img src="/image/logoTCN.png" alt="Avatar">
            <h3>M·∫°c Nguy√™n</h3>
            <p>Ch√†o m·ª´ng b·∫°n tr·ªü l·∫°i üëã</p>
        </div>

        <ul class="menu">
            <li class="active"><i class="bi bi-speedometer2"></i> T·ªïng Quan</li>
            <a href="customer-manage.html"><li><i class="bi bi-person-lines-fill"></i> Qu·∫£n L√Ω T√†i Kho·∫£n</li></a>
            <a href="product-management.html"><li><i class="bi bi-box-seam"></i> Qu·∫£n L√Ω S·∫£n Ph·∫©m</li></a>
            <a href="category-manage.html"><li><i class="bi bi-tags"></i> Qu·∫£n L√Ω Danh M·ª•c</li></a>

            <li class="has-submenu">
                <div class="menu-item">
                    <i class="bi bi-truck"></i>
                    <span>Qu·∫£n L√Ω ƒê∆°n H√†ng</span>
                    <i class="bi bi-chevron-right arrow"></i>
                </div>
                <ul class="submenu">
                    <a href="uncomfirmed-order-manage.html"><li>Ch∆∞a X√°c Nh·∫≠n</li></a>
                    <a href="comfirmed-order-manage.html"><li>ƒê√£ X√°c Nh·∫≠n</li></a>
                </ul>
            </li>

            <a href="blog-manage.html"><li><i class="bi bi-journal-text"></i> Qu·∫£n L√Ω Blog</li></a>
            <a href="promotion-manage.html"><li><i class="bi bi-megaphone"></i> Qu·∫£n L√Ω Khuy·∫øn M√£i</li></a>
            <a href="statistics.html"><li><i class="bi bi-bar-chart"></i> B√°o C√°o & Th·ªëng K√™</li></a>
        </ul>
    </aside>


    <div class="profile-page">
        <!-- LEFT SIDE -->
        <div class="profile-left">
            <div class="avatar-box">
                <div class="avatar-wrapper">
                    <img src="/image/logoTCN.png" alt="Avatar" class="avatar-img">
                    <span class="avatar-camera">
        <i class="bi bi-camera-fill"></i>
    </span>
                </div>
                <input type="file" id="avatar-upload" accept="image/*" hidden>
            </div>
            <h3>M·∫°c Nguy√™n</h3>
        </div>
    </div>

    <!-- RIGHT SIDE -->
    <div class="profile-right">
        <!-- Th√¥ng tin c∆° b·∫£n -->
        <h4>Th√¥ng tin c∆° b·∫£n</h4>
        <form id="profileForm">
            <label>H·ªç t√™n
                <input name="fullname" value="M·∫°c Nguy√™n">
            </label>
            <label>Email
                <input type="email" name="email" value="macnguyen123@gmail.com">
            </label>
            <label>S·ªë ƒëi·ªán tho·∫°i
                <input name="phone" value="0123456789">
            </label>
            <div class="actions">
                <button type="submit" class="btn">L∆∞u thay ƒë·ªïi</button>
            </div>
        </form>

        <hr>

        <h4 class="fw-bold">Th√¥ng tin ng√¢n h√†ng</h4>
        <div class="bank-info" id="bankView">
            <div class="bank-details"><p><strong>Ng√¢n h√†ng:</strong> <span id="bankNameText">Vietcombank</span></p>
                <p><strong>S·ªë t√†i kho·∫£n:</strong> <span id="acctMasked">**** **** 1234</span></p>
                <p><strong>Ch·ªß t√†i kho·∫£n:</strong> <span id="acctNameText">M·∫°c Nguy√™n</span></p></div>
            <button id="btn-edit-bank" class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil-square"></i>
            </button>
            <div class="bank-qr"><p><strong>M√£ QR thanh to√°n</strong></p> <img src="/image/qr/qr.png" alt="QR Code">
            </div>
        </div>

        <!-- B·∫£n ch·ªânh s·ª≠a -->
        <div class="bank-info-edit p-3 border rounded mb-3 d-none" id="bankEdit">
            <form id="bankForm"><label>Ng√¢n h√†ng <select name="bankName" id="bankName" class="form-select" required>
                <option value="">-- Ch·ªçn ng√¢n h√†ng --</option>
                <option value="Momo">Momo</option>
                <option value="Vietcombank">Vietcombank</option>
                <option value="Techcombank">Techcombank</option>
            </select> </label> <label>S·ªë t√†i kho·∫£n
                <div class="input-group"><input name="accountNumber" id="accountNumber" value="12341234" required
                                                class="form-control"> <span class="input-group-text" id="toggleEye"><i
                        class="bi bi-eye"></i></span></div>
            </label> <label>Ch·ªß t√†i kho·∫£n <input name="accountHolder" id="accountHolder" value="M·∫°c Nguy√™n" required
                                                 class="form-control"> </label> <label class="mt-2">M√£ QR thanh
                to√°n</label>
                <div class="mt-2"><img id="qrPreviewImg" src="" width="140" class="border rounded d-none">
                    <div class="border rounded p-4 d-inline-block mt-2" id="khungThemQR" style="cursor:pointer;"><i
                            class="bi bi-plus-lg fs-3"></i></div>
                    <input type="file" id="qrUpload" accept="image/*" hidden></div>
                <div class="mt-3 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                    <button type="button" id="btnCancelBank" class="btn btn-secondary">H·ªßy</button>
                </div>
            </form>
        </div>

        <!-- ƒê·ªïi m·∫≠t kh·∫©u -->
        <h4>ƒê·ªïi m·∫≠t kh·∫©u</h4>
        <form id="changePassForm">
            <small class="password-hint">
                M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª±, bao g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát.
            </small>
            <label>M·∫≠t kh·∫©u c≈©
                <input type="text" name="oldPassword" required>
            </label>
            <label>M·∫≠t kh·∫©u m·ªõi
                <input type="text" name="newPassword" required minlength="8">
            </label>
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u
                <input type="text" name="confirmPassword" required>
            </label>
            <div class="actions">
                <button type="submit" class="btn btn-primary">ƒê·ªïi m·∫≠t kh·∫©u</button>
            </div>
            <p id="passMsg" class="muted"></p>
        </form>
    </div>
</div>


</div>
</div>
<script>
    document.querySelectorAll('.has-submenu .menu-item').forEach(item => {
        item.addEventListener('click', () => {
            item.parentElement.classList.toggle('open');
        });
    });


    document.addEventListener("DOMContentLoaded", function () {
        // =============================
// UPLOAD ·∫¢NH AVATAR
// =============================
        const avatarWrapper = document.querySelector(".avatar-wrapper");
        const avatarUpload = document.getElementById("avatar-upload");
        const avatarImg = document.querySelector(".avatar-img");

// Khi b·∫•m v√†o icon camera => m·ªü ch·ªçn file
        avatarWrapper.addEventListener("click", () => {
            avatarUpload.click();
        });

// Hi·ªÉn th·ªã avatar preview sau khi ch·ªçn ·∫£nh
        avatarUpload.addEventListener("change", function () {
            const file = this.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                avatarImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });


        /* =============================
           KH·ªûI T·∫†O BI·∫æN
        ==============================*/
        const bankView = document.getElementById("bankView");
        const bankEdit = document.getElementById("bankEdit");
        const btnEdit = document.getElementById("btn-edit-bank");
        const btnCancel = document.getElementById("btnCancelBank");
        const bankForm = document.getElementById("bankForm");

        const accountNumberInput = document.getElementById("accountNumber");
        const toggleEye = document.getElementById("toggleEye").querySelector("i");
        const acctMaskedText = document.getElementById("acctMasked");

        const qrUpload = document.getElementById("qrUpload");
        const qrPreviewImg = document.getElementById("qrPreviewImg");
        const khungThemQR = document.getElementById("khungThemQR");

        // D·ªØ li·ªáu th·∫≠t
        let actualAcct = accountNumberInput.value || "12341234";
        let isMasked = true;


        /* =============================
           MASK S·ªê T√ÄI KHO·∫¢N
        ==============================*/
        function maskAccount(acct) {
            const s = acct.toString().replace(/\D/g, "");
            if (!s) return "----";
            const last4 = s.slice(-4);
            const masked = s.slice(0, -4).replace(/\d/g, "*");
            return (masked + last4).replace(/(.{4})/g, "$1 ").trim();
        }

        function updateMaskedDisplay() {
            acctMaskedText.textContent = maskAccount(actualAcct);
        }


        /* =============================
           TOGGLE EYE HI·ªÜN / ·∫®N
        ==============================*/
        toggleEye.addEventListener("click", () => {
            isMasked = !isMasked;

            if (isMasked) {
                accountNumberInput.value = maskAccount(actualAcct);
                toggleEye.className = "bi bi-eye";      // ƒëang ·∫©n => eye
            } else {
                accountNumberInput.value = actualAcct;
                toggleEye.className = "bi bi-eye-slash"; // ƒëang hi·ªán => eye slash
            }
        });


        /* =============================
           M·ªû FORM CH·ªàNH S·ª¨A
        ==============================*/
        btnEdit.addEventListener("click", () => {
            bankView.classList.add("d-none");
            bankEdit.classList.remove("d-none");

            // Reset s·ªë t√†i kho·∫£n
            accountNumberInput.value = isMasked ? maskAccount(actualAcct) : actualAcct;
            toggleEye.className = isMasked ? "bi bi-eye" : "bi bi-eye-slash";
        });


        /* =============================
           N√öT H·ª¶Y
        ==============================*/
        btnCancel.addEventListener("click", () => {
            bankEdit.classList.add("d-none");
            bankView.classList.remove("d-none");

            // Reset QR preview
            qrUpload.value = "";
            qrPreviewImg.classList.add("d-none");
            qrPreviewImg.src = "";
        });


        /* =============================
           T·∫¢I ·∫¢NH QR (Preview)
        ==============================*/
        khungThemQR.addEventListener("click", () => qrUpload.click());

        qrUpload.addEventListener("change", () => {
            const file = qrUpload.files[0];
            if (!file) {
                qrPreviewImg.classList.add("d-none");
                return;
            }

            const reader = new FileReader();
            reader.onload = e => {
                qrPreviewImg.src = e.target.result;
                qrPreviewImg.classList.remove("d-none");
            };
            reader.readAsDataURL(file);
        });


        /* =============================
           KH·ªûI T·∫†O BAN ƒê·∫¶U
        ==============================*/
        updateMaskedDisplay();

        // ================== POPUP ƒêƒÇNG XU·∫§T ==================
        const logoutBtn = document.getElementById("logoutBtn");
        const logoutModal = document.getElementById("logoutModal");
        const cancelLogout = document.getElementById("cancelLogout");

        logoutBtn.onclick = () => logoutModal.style.display = "flex";
        cancelLogout.onclick = () => logoutModal.style.display = "none";
    });
</script>



</body>
</html>
